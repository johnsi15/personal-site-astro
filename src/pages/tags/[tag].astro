---
import { CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/index.astro'

import PostsGrid from '../../components/PostsGrid';
import Cover from '../../components/Cover';
import PostTitle from '../../components/PostTitle';

export async function getStaticPaths() {
	const posts = await getCollection('blog');

	return posts.map((post) => {
    // console.log({ tags: post.data.primaryTag.slug })
    const { name, slug } = post.data.primaryTag
    return {
      params: { tag: slug },
      props: { tagName: name }
    }
  });
}
type Props = CollectionEntry<'blog'>;
// const blogEntries = await getCollection('blog');

const {tagName} = Astro.props;
const { tag } = Astro.params;

// console.log({tag})
// console.log({tagName})
const blogEntries = (await getCollection('blog')).sort(
	(a, b) => a.data.publishedDate.valueOf() - b.data.publishedDate.valueOf()
);

const posts = blogEntries.filter(post => post.data.primaryTag.slug === tag)
---

<Layout>
  <Cover>
    <PostTitle capitalize='capitalize'>{tagName}</PostTitle>
  </Cover>
  <section id='Tag' class='container'>
    <PostsGrid posts={posts} columns='3' />
  </section>
</Layout>

<style>
	#Tag {
    /* margin-top: 70px; */
    flex: 1;
  }
</style>
